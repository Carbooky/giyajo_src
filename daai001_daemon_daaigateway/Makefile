#############################################################################
# Makefile for building: daai001_daemon_daaigateway
# Generated by ireta: 2013-02-18
# Version: 0.0.3
#############################################################################

include ../../../source/global.mk ../../../source/command.mk ../../../source/path.mk ../../../source/define.mk

INCPATH	= $(INCLUDE) -I./gwInc/ -I/usr/include/libxml2/ -I../../../include -I/home/ubuntu/gateway_proj/tr-c_daai/3rd/

ifdef WIN32
CWMP_LIBS = -L../../../libs -lctools -lcwmpdaemon -lws2_32
else
CWMP_LIBS = ../../../libs/libcwmpdaemon.a \
../../../libs/libctools.a \
../../../libs/libcwmp.a
endif

GW_LIBS = ../../../libs/libroxml.a \
../../../libs/libctools.a 

#GW_LIBS =

CFLAGS += -fno-stack-protector

LIBS = -lpthread -lxml2 -ljpeg -lrt -lm -lm -lmyroxml

####### Files

SOURCES =  \
daai001_daaigateway.c \
gwSrc/gateway_api.c \
gwSrc/lib_crc16.c \
gwSrc/protocols.c \
gwSrc/cam_capture.c \
gwSrc/util.c

SOURCES_GW = gwSrc/main.c \
gwSrc/gateway_api.c \
gwSrc/lib_crc16.c \
gwSrc/protocols.c \
gwSrc/cam_capture.c \
gwSrc/util.c

SOURCE_GW_MONITOR = gwSrc/gateway_monitor.c \
gwSrc/gateway_api.c \
gwSrc/lib_crc16.c \
gwSrc/protocols.c \
gwSrc/util.c 

OBJECTS = \
daai001_daaigateway.o \
gwSrc/gateway_api.o \
gwSrc/lib_crc16.o \
gwSrc/protocols.o \
gwSrc/cam_capture.o \
gwSrc/util.o

OBJ_GW = \
gwSrc/main.o \
gwSrc/gateway_api.o \
gwSrc/lib_crc16.o \
gwSrc/protocols.o \
gwSrc/cam_capture.o \
gwSrc/util.o

SCRIPTS = catInfoFiles.sh \
getExternalIP.sh \
eversolar_ID_table.txt \
listBackupNFileName.sh 

DESTDIR       = ..$(PS)..$(PS)..$(PS)env$(PS)Profiles
DESTDIR_ENV   = ..$(PS)..$(PS)..$(PS)env
SCRIPTS_DIR   = scripts$(PS)

ifdef WIN32
TARGET        = daai001_daaigateway.exe
else
TARGET        = daai001_daaigateway
endif

first: all
####### Implicit rules

.SUFFIXES: .c

%.o: %.c
	@echo 'Building file: $<'
	@echo 'Invoking: GCC C Compiler'
	$(CC) -s -c $(INCPATH) $(CFLAGS) -o "$@" "$<"
	@echo 'Finished building: $<'
	@echo ' '

####### Build rules

gateway_only:
	$(CC) -o test_gateway $(SOURCES_GW) $(INCPATH) $(CFLAGS) $(GW_LIBS) $(LIBS)
	$(COPY) test_gateway $(DESTDIR_ENV)

all: Makefile $(TARGET) GATEWAY_MONITOR


$(TARGET):  $(OBJECTS)
	$(LINK) $(LFLAGS) -o $(TARGET) $(OBJECTS) $(CWMP_LIBS) $(LIBS)
	$(STRIP) $(TARGET)
	$(COPY) $(TARGET) $(DESTDIR)

	pushd $(SCRIPTS_DIR);$(COPY) $(SCRIPTS) ..$(PS)$(DESTDIR_ENV)

GATEWAY_MONITOR:
	$(CC) -o gateway_monitor $(SOURCE_GW_MONITOR) $(INCPATH) $(CFLAGS) $(GW_LIBS) $(LIBS)
	$(COPY) gateway_monitor $(DESTDIR_ENV)

clean:
	$(DEL_FILE) $(OBJECTS)
	$(DEL_FILE) $(TARGET)
	$(DEL_FILE) $(DESTDIR)$(PS)$(TARGET)

	pushd $(DESTDIR_ENV);$(DEL_FILE) $(SCRIPTS)

